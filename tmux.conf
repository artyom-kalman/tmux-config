# ====== Core Settings ======
set-option -sa terminal-overrides ",xterm*:Tc"
set -g default-terminal "tmux-256color"  # Better color support
set -g escape-time 50                    # Faster escape sequences
set -g focus-events on                   # Better terminal integration

# ====== Key Bindings ======
set -g prefix C-e                       

unbind r
bind r source-file ~/.config/tmux/tmux.conf

bind  c  new-window      -c "#{pane_current_path}"
bind  %  split-window -h -c "#{pane_current_path}"

# Vim-style pane navigation
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# ====== Mouse & UI ======
set -g mouse on                          # Enable mouse support
set -g base-index 1                      # Start window numbering at 1
setw -g pane-base-index 1                # Start pane numbering at 1
set -g renumber-windows on               # Re-number windows after closing

# Rename numeric sessions to start from 1 instead of 0
set-hook -g session-created 'run-shell "name=\"$(tmux display-message -p \"##S\")\"; [ \"$name\" -eq \"$name\" ] 2>/dev/null && tmux rename-session -t \"$name\" \"$((name + 1))\" || true"'

# ======Plugins===========
set -g @plugin 'catppuccin/tmux#v2.1.3' 
set -g @catppuccin_flavor "macchiato"
set -g @catppuccin_window_status_style "none"

set -g @plugin 'tmux-plugins/tmux-sensible' 
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @plugin 'tmux-plugins/tmux-logging'

# ======Auto-restor=======
set -g @continuum-restore 'on'

# Initialize TPM (must be at the bottom)
run '~/.config/tmux/plugins/tpm/tpm'

# ── App-aware window tab colors ──
# claude=terracotta  nvim=green  lazygit=blue  bun=gold  default=catppuccin
set -g @_w_nbg  "#{?#{m:claude,#{pane_current_command}},#d97757,#{?#{m:nvim,#{pane_current_command}},#57a143,#{?#{m:lazygit,#{pane_current_command}},#7aa2f7,#{?#{m:bun,#{pane_current_command}},#f9c859,#5b8c85}}}}"
set -g @_w_nfg  "#{?#{m:claude,#{pane_current_command}},#1e2030,#{?#{m:nvim,#{pane_current_command}},#1e2030,#{?#{m:lazygit,#{pane_current_command}},#1e2030,#{?#{m:bun,#{pane_current_command}},#1e2030,#1e2030}}}}"
set -g @_w_tbg  "#{?#{m:claude,#{pane_current_command}},#493429,#{?#{m:nvim,#{pane_current_command}},#1e3220,#{?#{m:lazygit,#{pane_current_command}},#1e2a4a,#{?#{m:bun,#{pane_current_command}},#3d3122,#1e2f2d}}}}"
set -g @_w_tfg  "#{?#{m:claude,#{pane_current_command}},#d97757,#{?#{m:nvim,#{pane_current_command}},#57a143,#{?#{m:lazygit,#{pane_current_command}},#7aa2f7,#{?#{m:bun,#{pane_current_command}},#f9c859,#8bd5ca}}}}"
# Current window: same app colors, brighter catppuccin defaults
set -g @_wc_nbg "#{?#{m:claude,#{pane_current_command}},#d97757,#{?#{m:nvim,#{pane_current_command}},#57a143,#{?#{m:lazygit,#{pane_current_command}},#7aa2f7,#{?#{m:bun,#{pane_current_command}},#f9c859,#{@thm_mauve}}}}}"
set -g @_wc_nfg "#{?#{m:claude,#{pane_current_command}},#1e2030,#{?#{m:nvim,#{pane_current_command}},#1e2030,#{?#{m:lazygit,#{pane_current_command}},#1e2030,#{?#{m:bun,#{pane_current_command}},#1e2030,#{@thm_crust}}}}}"
set -g @_wc_tbg "#{?#{m:claude,#{pane_current_command}},#493429,#{?#{m:nvim,#{pane_current_command}},#1e3220,#{?#{m:lazygit,#{pane_current_command}},#1e2a4a,#{?#{m:bun,#{pane_current_command}},#3d3122,#{@thm_surface_1}}}}}"
set -g @_wc_tfg "#{?#{m:claude,#{pane_current_command}},#d97757,#{?#{m:nvim,#{pane_current_command}},#57a143,#{?#{m:lazygit,#{pane_current_command}},#7aa2f7,#{?#{m:bun,#{pane_current_command}},#f9c859,#{@thm_fg}}}}}"

# Tab label: show app name for custom apps, directory for everything else
set -g @_w_label "#{?#{m:claude,#{pane_current_command}},claude ,#{?#{m:nvim,#{pane_current_command}},nvim ,#{?#{m:lazygit,#{pane_current_command}},lazygit ,#{?#{m:bun,#{pane_current_command}},bun ,#{b:pane_current_path} }}}}"

set -g window-status-format "#[fg=#{E:@_w_nbg},bg=#{@thm_mantle}]#[fg=#{E:@_w_nfg},bg=#{E:@_w_nbg}] #I #[fg=#{E:@_w_tfg},bg=#{E:@_w_tbg}] #{E:@_w_label}#[fg=#{E:@_w_tbg},bg=#{@thm_mantle}]#[default]"

set -g window-status-current-format "#[fg=#{E:@_wc_nbg},bg=#{@thm_mantle}]#[fg=#{E:@_wc_nfg},bg=#{E:@_wc_nbg}] #I #[fg=#{E:@_wc_tfg},bg=#{E:@_wc_tbg}] #{E:@_w_label}#[fg=#{E:@_wc_tbg},bg=#{@thm_mantle}]#[default]"

# ====== Status Bar ======
set -g status-position top
set -g status-left-length 100
set -g status-right-length 100
set -g status-left "#{E:@catppuccin_status_session}  "

# Right side: directory, git branch, session, time
set -g @catppuccin_date_time_text " %H:%M"

# Git branch (lightweight, no gitmux needed)
set -g @catppuccin_gitmux_text " #(cd #{pane_current_path} && git rev-parse --abbrev-ref HEAD 2>/dev/null || echo '-')"

set -g status-right "#{E:@catppuccin_status_directory}"
set -ag status-right "#{E:@catppuccin_status_gitmux}"
set -ag status-right "#{E:@catppuccin_status_date_time}"

